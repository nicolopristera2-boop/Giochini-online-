<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <title>Super Mario Lobby</title>
    <style>
        body { margin: 0; background: #5c94fc; overflow: hidden; display: flex; justify-content: center; align-items: center; height: 100vh; font-family: 'Press Start 2P', cursive, sans-serif; }
        canvas { background: #5c94fc; border-bottom: 20px solid #c84c0c; box-shadow: 0 0 20px rgba(0,0,0,0.5); }
        .ui { position: absolute; top: 20px; color: white; font-size: 20px; text-shadow: 2px 2px 0 #000; text-align: center; }
    </style>
</head>
<body>

<div class="ui">LOBBY<br><small>Usa le frecce per muoverti, â¬† per entrare</small></div>
<canvas id="lobbyCanvas" width="800" height="600"></canvas>

<script>
    const canvas = document.getElementById('lobbyCanvas');
    const ctx = canvas.getContext('2d');

    // --- STATO DEL GIOCO ---
    // Controlliamo se il livello 2 Ã¨ sbloccato
    let level2Unlocked = localStorage.getItem('level2Unlocked') === 'true';

    // --- IL GIOCATORE ---
    const player = { x: 50, y: 480, w: 30, h: 40, color: 'red', speed: 5, vx: 0 };

    // --- LE PORTE (LIVELLI) ---
    const doors = [
        { x: 200, y: 420, w: 60, h: 100, label: "LIV 1", file: "livello1.html", locked: false, color: "#ffd700" },
        { x: 500, y: 420, w: 60, h: 100, label: "LIV 2", file: "livello2.html", locked: !level2Unlocked, color: level2Unlocked ? "#ffd700" : "#333" }
    ];

    // --- INPUT ---
    const keys = {};
    window.addEventListener('keydown', e => keys[e.code] = true);
    window.addEventListener('keyup', e => keys[e.code] = false);

    function update() {
        // Movimento
        if (keys['ArrowRight']) player.x += player.speed;
        if (keys['ArrowLeft']) player.x -= player.speed;

        // Confini
        if (player.x < 0) player.x = 0;
        if (player.x > canvas.width - player.w) player.x = canvas.width - player.w;

        // Interazione con le porte
        if (keys['ArrowUp'] || keys['Space']) {
            doors.forEach(door => {
                // Se il giocatore Ã¨ davanti alla porta (collisione semplice)
                if (player.x < door.x + door.w && player.x + player.w > door.x) {
                    if (!door.locked) {
                        // CARICA IL FILE DEL LIVELLO (COLLEGAMENTO A -> B)
                        window.location.href = door.file; 
                    }
                }
            });
        }
    }

    function draw() {
        ctx.clearRect(0, 0, canvas.width, canvas.height);

        // Disegna il pavimento
        ctx.fillStyle = "#c84c0c"; // Terra marrone
        ctx.fillRect(0, 520, canvas.width, 80);
        ctx.fillStyle = "#00a800"; // Erba
        ctx.fillRect(0, 520, canvas.width, 20);

        // Disegna le porte
        doors.forEach(door => {
            ctx.fillStyle = door.color;
            ctx.fillRect(door.x, door.y, door.w, door.h);
            
            // Cornice porta
            ctx.strokeStyle = "#000";
            ctx.lineWidth = 3;
            ctx.strokeRect(door.x, door.y, door.w, door.h);

            // Testo livello
            ctx.fillStyle = "white";
            ctx.font = "14px Arial";
            ctx.textAlign = "center";
            ctx.fillText(door.label, door.x + door.w/2, door.y - 10);

            if(door.locked) {
                ctx.fillStyle = "red";
                ctx.fillText("ðŸ”’", door.x + door.w/2, door.y + door.h/2);
            }
        });

        // Disegna Giocatore (Mario cubettoso)
        ctx.fillStyle = player.color;
        ctx.fillRect(player.x, player.y, player.w, player.h);
        
        // Istruzioni interattive
        doors.forEach(door => {
            if (player.x < door.x + door.w && player.x + player.w > door.x) {
                ctx.fillStyle = "white";
                ctx.font = "bold 16px Arial";
                if(door.locked) {
                    ctx.fillText("BLOCCATO", player.x + player.w/2, player.y - 20);
                } else {
                    ctx.fillText("ENTRA â¬†", player.x + player.w/2, player.y - 20);
                }
            }
        });
    }

    function loop() {
        update();
        draw();
        requestAnimationFrame(loop);
    }

    loop();
</script>
</body>
</html>
