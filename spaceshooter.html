<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Space Shooter - Game Boy Edition</title>
    <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>ðŸš€</text></svg>">
    
    <style>
        /* --- STILE GENERALE --- */
        * { box-sizing: border-box; }

        body { 
            font-family: 'Segoe UI', sans-serif; 
            margin: 0; padding: 0;
            background-color: #111; color: #fff; 
            display: flex; flex-direction: column; align-items: center; justify-content: center;
            height: 100vh; 
            overflow: hidden; 
            user-select: none;
            touch-action: none; 
            overscroll-behavior-y: none; 
        }

        /* --- NUOVO STILE PUNTEGGIO INTEGRATO (Display LCD RetrÃ²) --- */
        #scoreBoard {
            background-color: #222; /* Sfondo scuro del display */
            border: 2px solid #111; /* Bordi per effetto incassato */
            border-bottom-color: #333;
            border-right-color: #333;
            border-radius: 4px;
            padding: 5px 15px;
            margin-bottom: 10px; /* Spazio tra punteggio e schermo di gioco */

            /* Stile testo luminoso */
            color: #00e5ff; 
            font-family: 'Courier New', monospace;
            font-size: 18px;
            font-weight: bold;
            text-shadow: 0 0 5px rgba(0, 229, 255, 0.7); /* Bagliore */
            text-align: center;
            
            box-shadow: inset 2px 2px 5px rgba(0,0,0,0.5); /* Ombra interna */
            flex-shrink: 0; /* Impedisce al punteggio di schiacciarsi */
        }

        /* --- UI OVERLAY (Solo Game Over e Tasto Exit ora) --- */
        #ui-layer {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            pointer-events: none; 
            padding: 10px;
        }

        #gameOverOverlay {
            position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%);
            background: rgba(0,0,0,0.85); border: 2px solid #ff4444; 
            color: white; padding: 20px; text-align: center; 
            display: none; pointer-events: auto; z-index: 50;
            border-radius: 8px;
        }
        
        .btn-retry {
            margin-top: 10px; padding: 10px 20px; 
            background: #ff4444; color: white; border: none; 
            font-family: monospace; font-size: 16px; cursor: pointer;
        }

        /* --- STRUTTURA GAME BOY / DESKTOP --- */
        
        /* Default Desktop */
        .game-container {
            position: relative; width: 800px; height: 600px;
            background-color: #333; border: 4px solid #444; border-radius: 10px;
            box-shadow: 0 0 40px rgba(0,0,0,0.8); overflow: hidden;
            display: flex; flex-direction: column;
            padding: 20px;
        }

        /* Contenitore per Schermo e Punteggio */
        .screen-bezel {
            position: relative;
            display: flex;
            flex-direction: column; /* Impila punteggio e canvas */
            align-items: center;
            height: 100%;
        }

        /* Wrapper per il canvas per gestire l'overlay */
        .canvas-wrapper {
            position: relative;
            width: 100%;
            flex-grow: 1; /* Occupa lo spazio rimanente */
            border: 4px solid #222;
            background-color: #000;
        }

        canvas { 
            display: block; width: 100%; height: 100%; 
            image-rendering: pixelated; 
        }

        /* Tasti nascosti su Desktop */
        #mobileControls { display: none; }
        .back-btn { 
            position: absolute; top: 10px; right: 10px; 
            text-decoration: none; color: #aaa; font-size: 12px; z-index: 60; 
            background: rgba(0,0,0,0.7); padding: 6px 10px; border-radius: 4px; pointer-events: auto;
            border: 1px solid #555;
        }

        /* --- MODALITÃ€ MOBILE (GAME BOY) --- */
        @media (max-width: 850px) {
            body { 
                background-color: #c0c0c0; 
                justify-content: flex-start; 
            }
            
            .game-container {
                width: 100%; 
                height: 100dvh; 
                border: none; border-radius: 0;
                background-color: #c0c0c0; /* Plastica Grigia */
                box-shadow: none;
                padding: 0;
            }

            /* Parte alta: La cornice dello schermo */
            .screen-bezel {
                background-color: #555; 
                border-radius: 10px 10px 40px 10px;
                margin: 10px 10px 0 10px;
                box-shadow: inset 2px 2px 5px rgba(0,0,0,0.6);
                
                flex: 1; 
                justify-content: center; 
                padding: 15px;
                min-height: 0;
                /* Flex-direction column Ã¨ giÃ  ereditato dal default, ma lo ribadiamo per chiarezza */
                flex-direction: column;
            }

            .canvas-wrapper {
                border: 4px solid #333;
                border-radius: 4px;
            }

            canvas {
                object-fit: contain; /* Mantiene proporzioni su mobile */
            }
            
            /* Parte bassa: I controlli */
            #mobileControls {
                display: flex; 
                width: 100%;
                height: auto; 
                min-height: 240px;
                
                justify-content: space-between; align-items: center;
                padding: 10px 20px; 
                padding-bottom: calc(20px + env(safe-area-inset-bottom));
                
                background: #c0c0c0;
                position: relative;
                flex-shrink: 0;
            }

            .d-pad { position: relative; width: 140px; height: 140px; }
            .d-btn {
                position: absolute; background: #222; border: none; width: 45px; height: 45px;
                box-shadow: 0 4px 0 #000; -webkit-tap-highlight-color: transparent;
            }
            .d-btn:active, .d-btn.active { transform: translate(0, 4px); box-shadow: none; background: #444; }
            
            #btnUp { top: 0; left: 47px; border-radius: 5px 5px 0 0; }
            #btnDown { bottom: 0; left: 47px; border-radius: 0 0 5px 5px; }
            #btnLeft { top: 47px; left: 0; border-radius: 5px 0 0 5px; }
            #btnRight { top: 47px; right: 0; border-radius: 0 5px 5px 0; }
            .d-center { position: absolute; top: 47px; left: 47px; width: 45px; height: 45px; background: #222; }

            .action-area { transform: rotate(-15deg); display: flex; gap: 20px; margin-bottom: 20px; }
            .a-btn {
                width: 60px; height: 60px; border-radius: 50%; border: none;
                background: #8f1c3f; color: rgba(0,0,0,0.3); font-family: sans-serif; font-weight: bold; font-size: 1.2rem;
                box-shadow: 2px 4px 0 #4a0f25;
            }
            .a-btn:active, .a-btn.active { transform: translate(2px, 4px); box-shadow: none; }

            .brand {
                position: absolute; bottom: calc(10px + env(safe-area-inset-bottom)); 
                right: 20px; 
                font-family: sans-serif; font-style: italic; color: #666; font-weight: bold; font-size: 12px;
                letter-spacing: 2px; opacity: 0.6;
            }
        }
    </style>
</head>
<body>

<div class="game-container">
    <div class="screen-bezel">
        
        <div id="scoreBoard">SCORE: 0000</div>

        <div class="canvas-wrapper">
            <canvas id="gameCanvas" width="800" height="600"></canvas>
            
            <div id="ui-layer">
                <a href="index.html" class="back-btn">EXIT</a>
            </div>

            <div id="gameOverOverlay">
                <h2 style="color: #ff4444; margin: 0 0 10px 0;">GAME OVER</h2>
                <p id="finalScore" style="font-size: 1.2rem;">Punti: 0</p>
                <button class="btn-retry" onclick="resetGame()">RIPROVA</button>
            </div>
        </div>

    </div>

    <div id="mobileControls">
        <div class="d-pad">
            <div class="d-center"></div>
            <button id="btnUp" class="d-btn"></button>
            <button id="btnDown" class="d-btn"></button>
            <button id="btnLeft" class="d-btn"></button>
            <button id="btnRight" class="d-btn"></button>
        </div>
        
        <div class="brand">NINTENDO GAME BOY</div>
        
        <div class="action-area">
            <button class="a-btn" style="background:#8f1c3f;">B</button>
            <button id="btnFire" class="a-btn">A</button>
        </div>
    </div>
</div>

<script>
    // --- SETUP ---
    const canvas = document.getElementById('gameCanvas');
    const ctx = canvas.getContext('2d');
    const scoreElement = document.getElementById('scoreBoard');
    const gameOverOverlay = document.getElementById('gameOverOverlay');
    const finalScoreText = document.getElementById('finalScore');

    let score = 0; 
    let gameOver = false; 
    let frameCount = 0;
    
    // Stato Tasti
    const keys = { ArrowUp: false, ArrowDown: false, ArrowLeft: false, ArrowRight: false, Space: false };

    // --- GESTIONE INPUT ---
    function bindTouch(id, code) {
        const btn = document.getElementById(id);
        if(!btn) return;
        
        // Gestione Touch
        btn.addEventListener('touchstart', (e) => { e.preventDefault(); keys[code] = true; btn.classList.add('active'); }, {passive: false});
        btn.addEventListener('touchend', (e) => { e.preventDefault(); keys[code] = false; btn.classList.remove('active'); }, {passive: false});
        // Gestione Mouse
        btn.addEventListener('mousedown', (e) => { keys[code] = true; btn.classList.add('active'); });
        btn.addEventListener('mouseup', (e) => { keys[code] = false; btn.classList.remove('active'); });
        btn.addEventListener('mouseleave', (e) => { keys[code] = false; btn.classList.remove('active'); });
    }

    bindTouch('btnUp', 'ArrowUp'); bindTouch('btnDown', 'ArrowDown');
    bindTouch('btnLeft', 'ArrowLeft'); bindTouch('btnRight', 'ArrowRight');
    bindTouch('btnFire', 'Space');

    window.addEventListener('keydown', e => {
        if(e.code === 'Space') keys.Space = true;
        if(e.key.startsWith('Arrow')) keys[e.key] = true;
    });
    window.addEventListener('keyup', e => {
        if(e.code === 'Space') keys.Space = false;
        if(e.key.startsWith('Arrow')) keys[e.key] = false;
    });

    // --- LOGICA DI GIOCO ---
    const player = { x: 385, y: 500, width: 30, height: 30, speed: 6 };
    let bullets = []; let enemyBullets = []; let enemies = []; let stars = [];
    
    const enemyConfig = {
        'invader': { score: 10, color: '#32CD32', shootChance: 0 },
        'crystal': { score: 20, color: '#00BFFF', shootChance: 0 },
        'hunter':  { score: 40, color: '#FF4500', shootChance: 0.015 },
        'saucer':  { score: 80, color: '#9370DB', shootChance: 0.025 }
    };
    const enemyTypes = Object.keys(enemyConfig);

    function resetGame() {
        gameOver = false; score = 0; scoreElement.innerText = "SCORE: 0000";
        enemies = []; bullets = []; enemyBullets = [];
        player.x = canvas.width/2 - 15; player.y = canvas.height - 50;
        gameOverOverlay.style.display = 'none'; loop();
    }

    function drawPlayer(x, y, w, h) {
        ctx.fillStyle = '#00e5ff'; ctx.beginPath(); ctx.moveTo(x+w/2, y); ctx.lineTo(x, y+h); ctx.lineTo(x+w/2, y+h-8); ctx.lineTo(x+w, y+h); ctx.fill();
        ctx.fillStyle = '#ff9900'; ctx.fillRect(x+w/2-2, y+h-4, 4, 6);
    }

    function drawEnemy(enemy) {
        const { x, y, width: w, height: h, color, type } = enemy;
        ctx.fillStyle = color; ctx.save(); ctx.translate(x, y);
        if(type === 'invader') {
            ctx.fillRect(w*0.2, h*0.2, w*0.6, h*0.6); ctx.fillRect(0, 0, w*0.2, h*0.4); ctx.fillRect(w*0.8, 0, w*0.2, h*0.4); ctx.fillRect(0, h*0.6, w*0.2, h*0.4); ctx.fillRect(w*0.8, h*0.6, w*0.2, h*0.4);
        } else if(type === 'hunter') {
            ctx.beginPath(); ctx.moveTo(w/2, h); ctx.lineTo(w, 0); ctx.lineTo(w/2, h*0.3); ctx.lineTo(0, 0); ctx.closePath(); ctx.fill();
        } else if(type === 'saucer') {
            ctx.beginPath(); ctx.ellipse(w/2, h/2, w/2, h/4, 0, 0, Math.PI*2); ctx.fill(); ctx.fillStyle = "#fff"; ctx.beginPath(); ctx.arc(w/2, h/2-5, w/4, Math.PI, 0); ctx.fill();
        } else { 
            ctx.beginPath(); ctx.moveTo(w/2, 0); ctx.lineTo(w, h/2); ctx.lineTo(w/2, h); ctx.lineTo(0, h/2); ctx.closePath(); ctx.fill(); ctx.fillStyle = "white"; ctx.fillRect(w/2-3, h/2-3, 6, 6);
        }
        ctx.restore();
    }

    function spawnEnemy() {
        let spawnRate = 60; if (score > 1000) spawnRate = 40;
        if (frameCount % spawnRate === 0) {
            const type = enemyTypes[Math.floor(Math.random() * enemyTypes.length)];
            const config = enemyConfig[type];
            enemies.push({ x: Math.random()*(canvas.width-30), y: -30, width: 30, height: 30, type: type, color: config.color, scoreValue: config.score, shootChance: config.shootChance, speed: 2 + Math.random()*2 });
        }
    }

    function checkCollision(r1, r2) {
        return (r1.x < r2.x + r2.width && r1.x + r1.width > r2.x && r1.y < r2.y + r2.height && r1.y + r1.height > r2.y);
    }

    function triggerGameOver() {
        gameOver = true; gameOverOverlay.style.display = 'block'; finalScoreText.innerText = "Punti: " + score;
    }

    function update() {
        if (gameOver) return;
        ctx.clearRect(0, 0, canvas.width, canvas.height);
        
        if(stars.length < 50) stars.push({ x: Math.random()*canvas.width, y: 0, size: Math.random()*2, speed: Math.random()*4+1 });
        stars.forEach((s, i) => { ctx.fillStyle = "white"; ctx.fillRect(s.x, s.y, s.size, s.size); s.y += s.speed; if(s.y > canvas.height) stars.splice(i, 1); });

        if (keys.ArrowUp && player.y > 0) player.y -= player.speed;
        if (keys.ArrowDown && player.y < canvas.height - player.height) player.y += player.speed;
        if (keys.ArrowLeft && player.x > 0) player.x -= player.speed;
        if (keys.ArrowRight && player.x < canvas.width - player.width) player.x += player.speed;
        if (keys.Space && frameCount % 10 === 0) bullets.push({ x: player.x+13, y: player.y, width: 4, height: 10, color: '#FFD700', speed: 10 });

        drawPlayer(player.x, player.y, player.width, player.height);

        for (let i = bullets.length - 1; i >= 0; i--) {
            let b = bullets[i]; b.y -= b.speed; ctx.fillStyle = b.color; ctx.fillRect(b.x, b.y, b.width, b.height); if (b.y < 0) bullets.splice(i, 1);
        }
        for (let i = enemyBullets.length - 1; i >= 0; i--) {
            let eb = enemyBullets[i]; eb.y += eb.speed; ctx.fillStyle = "#FF0000"; ctx.fillRect(eb.x, eb.y, eb.width, eb.height);
            if (checkCollision(eb, player)) triggerGameOver();
            if (eb.y > canvas.height) enemyBullets.splice(i, 1);
        }

        spawnEnemy();
        
        for (let i = enemies.length - 1; i >= 0; i--) {
            let e = enemies[i]; e.y += e.speed; drawEnemy(e);
            if (e.shootChance > 0 && Math.random() < e.shootChance) enemyBullets.push({ x: e.x + e.width/2 - 2, y: e.y + e.height, width: 5, height: 10, speed: 5 });
            let pad = 4; if (checkCollision({x: player.x+pad, y: player.y+pad, width: player.width-pad*2, height: player.height-pad*2}, e)) triggerGameOver();
            if (e.y > canvas.height) { enemies.splice(i, 1); continue; }
            for (let j = bullets.length - 1; j >= 0; j--) {
                if (checkCollision(bullets[j], e)) {
                    score += e.scoreValue; scoreElement.innerText = "SCORE: " + score.toString().padStart(4, '0');
                    enemies.splice(i, 1); bullets.splice(j, 1); break;
                }
            }
        }
        frameCount++; 
    }

    function loop() { update(); if(!gameOver) requestAnimationFrame(loop); }
    resetGame();
</script>
</body>
</html>
