<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Space Shooter</title>
    <style>
        body { margin: 0; background: #050505; font-family: 'Segoe UI', sans-serif; display: flex; flex-direction: column; align-items: center; justify-content: center; height: 100vh; color: white; overflow: hidden; }
        canvas { border: 2px solid #00E5FF; box-shadow: 0 0 20px #00E5FF; background: #000; }
        .back-btn { position: absolute; top: 20px; left: 20px; text-decoration: none; color: #00E5FF; font-weight: bold; text-shadow: 0 0 5px #00E5FF; }
    </style>
</head>
<body>

<a href="index.html" class="back-btn" data-i18n="backHome">üè† Home</a>
<canvas id="gameCanvas" width="600" height="500"></canvas>

<script src="lingue.js"></script>
<script>
    window.isGamePage = true;

    const canvas = document.getElementById('gameCanvas');
    const ctx = canvas.getContext('2d');

    let player = { x: 275, y: 430, w: 40, h: 40 };
    let bullets = [];
    let enemies = [];
    let stars = []; // Array per le stelle
    let score = 0;
    let lives = 3;
    let isGameOver = false;
    let isPlaying = false;
    let frame = 0;

    // Crea stelle iniziali
    for(let i=0; i<50; i++) {
        stars.push({
            x: Math.random() * canvas.width,
            y: Math.random() * canvas.height,
            size: Math.random() * 2,
            speed: Math.random() * 3 + 1
        });
    }

    function drawStarfield() {
        ctx.fillStyle = "white";
        stars.forEach(star => {
            ctx.fillRect(star.x, star.y, star.size, star.size);
            star.y += star.speed;
            if (star.y > canvas.height) {
                star.y = 0;
                star.x = Math.random() * canvas.width;
            }
        });
    }

    function drawPlayer() {
        ctx.shadowBlur = 10;
        ctx.shadowColor = "#00E5FF";
        ctx.fillStyle = '#00E5FF';
        
        // Disegna una navicella triangolare invece di un quadrato
        ctx.beginPath();
        ctx.moveTo(player.x + player.w/2, player.y); // Punta
        ctx.lineTo(player.x + player.w, player.y + player.h); // Angolo dx
        ctx.lineTo(player.x + player.w/2, player.y + player.h - 10); // Motore incavato
        ctx.lineTo(player.x, player.y + player.h); // Angolo sx
        ctx.closePath();
        ctx.fill();
        
        ctx.shadowBlur = 0; // Resetta ombra
    }

    function drawEnemies() {
        enemies.forEach((e, i) => {
            ctx.shadowBlur = 5;
            ctx.shadowColor = "#FF0055";
            ctx.fillStyle = '#FF0055';
            
            // Nemici Alien
            ctx.fillRect(e.x, e.y, 40, 30);
            // Occhi alieno
            ctx.fillStyle = "black";
            ctx.fillRect(e.x + 8, e.y + 10, 5, 5);
            ctx.fillRect(e.x + 27, e.y + 10, 5, 5);

            ctx.shadowBlur = 0;
            e.y += 2.5; // Velocit√† nemico

            // Collisione Player
            if(e.x < player.x + player.w && e.x + 40 > player.x &&
               e.y < player.y + player.h && e.y + 30 > player.y) {
                   lives--;
                   enemies.splice(i, 1);
                   if(lives <= 0) isGameOver = true;
            }
            if(e.y > canvas.height) enemies.splice(i, 1);
        });
    }

    function drawBullets() {
        ctx.fillStyle = '#FFFF00';
        ctx.shadowBlur = 5;
        ctx.shadowColor = "#FFFF00";
        bullets.forEach((b, i) => {
            ctx.fillRect(b.x, b.y, 4, 15);
            b.y -= 8;
            if(b.y < 0) bullets.splice(i, 1);
        });
        ctx.shadowBlur = 0;
    }

    function update() {
        if(!isPlaying || isGameOver) return;

        // Collisioni Bullet-Enemy
        bullets.forEach((b, bi) => {
            enemies.forEach((e, ei) => {
                if(b.x < e.x + 40 && b.x + 4 > e.x &&
                   b.y < e.y + 30 && b.y + 10 > e.y) {
                       score += 100;
                       bullets.splice(bi, 1);
                       enemies.splice(ei, 1);
                   }
            });
        });

        // Spawn Nemici
        if(frame % 50 === 0) {
            enemies.push({ x: Math.random() * (canvas.width - 40), y: -30 });
        }
        frame++;
    }

    function draw() {
        // Pulisci con leggero effetto scia
        ctx.fillStyle = "rgba(0, 0, 0, 0.4)"; 
        ctx.fillRect(0, 0, canvas.width, canvas.height);
        
        drawStarfield();

        if(!isPlaying) {
            ctx.fillStyle = "#00E5FF";
            ctx.font = "24px Arial";
            ctx.textAlign = "center";
            ctx.shadowBlur = 10;
            ctx.shadowColor = "#00E5FF";
            ctx.fillText(t('startMsg'), canvas.width/2, canvas.height/2);
            ctx.shadowBlur = 0;
            return;
        }

        drawPlayer();
        drawBullets();
        drawEnemies();

        // UI
        ctx.fillStyle = "white";
        ctx.font = "18px Arial";
        ctx.textAlign = "left";
        ctx.fillText(t('score') + score, 15, 30);
        ctx.fillText(t('lives') + lives, 15, 55);

        if(isGameOver) {
            ctx.fillStyle = "rgba(0,0,0,0.8)";
            ctx.fillRect(0,0,canvas.width, canvas.height);
            
            ctx.fillStyle = "#FF0055";
            ctx.font = "bold 40px Arial";
            ctx.textAlign = "center";
            ctx.shadowBlur = 20;
            ctx.shadowColor = "red";
            ctx.fillText(t('gameOver'), canvas.width/2, canvas.height/2);
            
            ctx.shadowBlur = 0;
            ctx.fillStyle = "white";
            ctx.font = "20px Arial";
            ctx.fillText(t('restartMsg'), canvas.width/2, canvas.height/2 + 50);
        }
    }

    function loop() {
        update();
        draw();
        requestAnimationFrame(loop);
    }

    window.addEventListener('keydown', (e) => {
        if(e.code === 'Space') {
            if(isGameOver) location.reload();
            if(!isPlaying) isPlaying = true;
            else bullets.push({x: player.x + 18, y: player.y});
        }
        if(e.key === 'ArrowLeft' && player.x > 0) player.x -= 20;
        if(e.key === 'ArrowRight' && player.x < canvas.width - player.w) player.x += 20;
    });

    loop();
</script>
</body>
</html>
