<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>T-Rex Run 2.0</title>
    <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>ü¶ñ</text></svg>">
    
    <style>
        body { 
            font-family: 'Segoe UI', sans-serif; 
            margin: 0; 
            background-color: #f4f4f4; 
            color: #333; 
            display: flex; 
            flex-direction: column; 
            min-height: 100vh;
            user-select: none;
        }
        
        /* Nascondiamo l'header qui perch√© c'√® gi√† il bottone Home dentro il gioco, 
           ma se lo vuoi tenere decommenta */
        /* header { background-color: #00979D; color: white; padding: 2rem; text-align: center; } */
        
        .container { 
            max-width: 800px; 
            margin: 40px auto; 
            padding: 20px; 
            background: white; 
            border-radius: 8px; 
            box-shadow: 0 0 10px rgba(0,0,0,0.1); 
            text-align: center;
            flex: 1;
            position: relative;
        }
        
        #gameCanvas {
            background-color: #fff;
            border-bottom: 2px solid #535353;
            display: block;
            margin: 20px auto;
            max-width: 100%;
            cursor: pointer;
        }

        .stats {
            display: flex;
            justify-content: space-between;
            width: 600px;
            margin: 0 auto;
            font-weight: bold;
            font-size: 1.2rem;
            color: #535353;
        }

        .btn-back {
            display: inline-block;
            background-color: #00979D; /* Colore tema */
            color: white;
            padding: 10px 15px;
            text-decoration: none;
            border-radius: 5px;
            margin-top: 20px;
            font-weight: bold;
        }
        .btn-back:hover { background-color: #007a80; }

        .instructions { color: #888; font-size: 0.9rem; margin-top: 10px;}
    </style>
</head>
<body>

<div class="container">
    <div class="stats">
        <span id="scoreText"></span>
        <span id="highScoreText">Record: 0</span>
    </div>

    <canvas id="gameCanvas" width="600" height="200"></canvas>
    
    <p class="instructions" data-i18n="startMsg">Premi SPAZIO o CLICCA per saltare</p>
    
    <a href="index.html" class="btn-back" data-i18n="backHome">‚¨Ö Torna alla Home</a>
</div>

<script src="lingue.js"></script>

<script>
    // 2. ATTIVIAMO LE TRADUZIONI
    window.isGamePage = true; 

    // --- SETUP ---
    const canvas = document.getElementById("gameCanvas");
    const ctx = canvas.getContext("2d");
    const scoreText = document.getElementById("scoreText");
    const highScoreText = document.getElementById("highScoreText");

    let score = 0;
    let highScore = localStorage.getItem('trexHighScore') || 0;
    let gameSpeed = 5;
    let isGameOver = false;
    let frames = 0;

    // Aggiorna testo iniziale (record)
    highScoreText.innerText = "Record: " + highScore;

    // --- OGGETTI DEL GIOCO ---

    // 1. Il Dinosauro
    const dino = {
        x: 50,
        y: 150,
        width: 40, 
        height: 40,
        dy: 0,
        jumpPower: -11,
        gravity: 0.6,
        grounded: true,
        emoji: "ü¶ñ",
        
        draw: function() {
            ctx.font = "40px Arial"; 
            
            // --- MAGIA PER GIRARE IL T-REX ---
            ctx.save(); // Salva lo stato attuale
            
            // Ribalta orizzontalmente il canvas
            ctx.scale(-1, 1); 
            
            // Poich√© l'asse X √® invertito, dobbiamo disegnare a coordinate negative.
            // (x * -1) - larghezza emoji
            ctx.fillText(this.emoji, -this.x - 40, this.y + 35);
            
            ctx.restore(); // Ripristina lo stato normale per il resto del gioco
            // ---------------------------------
        },
        jump: function() {
            if (this.grounded) {
                this.dy = this.jumpPower;
                this.grounded = false;
            }
        },
        update: function() {
            if (!this.grounded) {
                this.dy += this.gravity;
                this.y += this.dy;
            }
            if (this.y > 150) {
                this.y = 150;
                this.dy = 0;
                this.grounded = true;
            }
            this.draw();
        }
    };

    // 2. Ostacoli (Cactus)
    const obstacles = {
        list: [],
        spawnTimer: 0,
        draw: function() {
            this.list.forEach(obs => {
                ctx.font = "40px Arial";
                ctx.fillText("üåµ", obs.x, obs.y + 35);
            });
        },
        update: function() {
            this.spawnTimer--;
            if (this.spawnTimer <= 0) {
                this.list.push({
                    x: canvas.width,
                    y: 150,
                    width: 30, // Hitbox un po' pi√π stretta dell'emoji
                    height: 40
                });
                this.spawnTimer = 60 + Math.random() * 60;
            }

            for (let i = 0; i < this.list.length; i++) {
                let obs = this.list[i];
                obs.x -= gameSpeed;

                if (obs.x + obs.width < 0) {
                    this.list.splice(i, 1);
                    i--;
                }

                // Collisione
                if (
                    dino.x < obs.x + obs.width - 10 &&
                    dino.x + dino.width - 10 > obs.x + 10 &&
                    dino.y < obs.y + obs.height &&
                    dino.y + dino.height > obs.y + 10
                ) {
                    gameOver();
                }
            }
            this.draw();
        }
    };

    // 3. Sfondo (Nuvole)
    const clouds = {
        list: [],
        spawnTimer: 0,
        update: function() {
            this.spawnTimer--;
            if (this.spawnTimer <= 0) {
                this.list.push({
                    x: canvas.width,
                    y: Math.random() * 80 + 20,
                    speed: gameSpeed * 0.3
                });
                this.spawnTimer = 100 + Math.random() * 100;
            }

            this.list.forEach((cloud, index) => {
                cloud.x -= cloud.speed;
                ctx.font = "30px Arial";
                ctx.fillText("‚òÅÔ∏è", cloud.x, cloud.y);
                if (cloud.x < -50) this.list.splice(index, 1);
            });
        }
    };

    // --- LOGICA PRINCIPALE ---

    function start() {
        if (isGameOver) reset();
        requestAnimationFrame(update);
    }

    function reset() {
        isGameOver = false;
        score = 0;
        gameSpeed = 5;
        obstacles.list = [];
        clouds.list = [];
        dino.y = 150;
        dino.dy = 0;
        // Usa t() per la traduzione iniziale
        scoreText.innerText = t('score') + "0";
    }

    function gameOver() {
        isGameOver = true;
        
        ctx.fillStyle = "rgba(0, 0, 0, 0.5)";
        ctx.fillRect(0, 0, canvas.width, canvas.height);
        
        ctx.fillStyle = "white";
        ctx.font = "bold 40px Segoe UI";
        ctx.textAlign = "center";
        
        // 3. USARE t() PER TRADURRE GAME OVER
        ctx.fillText(t('gameOver'), canvas.width / 2, canvas.height / 2);
        
        ctx.font = "20px Segoe UI";
        // 4. USARE t() PER MESSAGGIO RIAVVIO
        ctx.fillText(t('restartMsg'), canvas.width / 2, canvas.height / 2 + 40);
        
        ctx.textAlign = "left"; 

        if (score > highScore) {
            highScore = score;
            localStorage.setItem('trexHighScore', highScore);
            highScoreText.innerText = "Record: " + highScore;
        }
    }

    function update() {
        if (isGameOver) return;

        requestAnimationFrame(update);
        ctx.clearRect(0, 0, canvas.width, canvas.height);
        frames++;

        if (frames % 10 === 0) {
            score++;
            // 5. USARE t() PER IL PUNTEGGIO LIVE
            scoreText.innerText = t('score') + score;
            
            if (score % 500 === 0) {
                gameSpeed += 0.5;
            }
        }

        clouds.update();
        dino.update();
        obstacles.update();
    }

    // --- CONTROLLI ---
    function handleInput(e) {
        if ((e.code === "Space" || e.code === "ArrowUp") && !isGameOver) {
            dino.jump();
        } else if ((e.code === "Space" || e.code === "ArrowUp") && isGameOver) {
            start(); 
        }
    }

    window.addEventListener("keydown", handleInput);
    canvas.addEventListener("touchstart", function(e) {
        e.preventDefault();
        if (!isGameOver) dino.jump();
        else start();
    });
    canvas.addEventListener("mousedown", function() {
        if (!isGameOver) dino.jump();
        else start();
    });

    // Avvio iniziale (potrebbe servire un piccolo ritardo per caricare le lingue, ma solitamente √® veloce)
    setTimeout(start, 100);

</script>

</body>
</html>
