<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>T-Rex Run</title>
    <style>
        /* --- STILE NORMALE / PULITO --- */
        body { 
            margin: 0; 
            background: #f0f2f5; /* Sfondo chiaro */
            font-family: 'Segoe UI', Roboto, Helvetica, Arial, sans-serif; /* Font moderno */
            display: flex; 
            flex-direction: column; 
            align-items: center; 
            justify-content: center; 
            height: 100vh; 
            overflow: hidden; 
            color: #333; 
        }

        canvas { 
            background: #87CEEB; /* Cielo azzurro */
            border-bottom: 4px solid #795548; /* Terreno marrone */
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
            border-radius: 8px;
        }

        .back-btn { 
            position: absolute; top: 20px; left: 20px; 
            text-decoration: none; color: #555; 
            font-weight: bold; font-size: 1.2rem; 
            transition: 0.3s; 
            background: white;
            padding: 5px 15px;
            border-radius: 20px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.2);
        }
        .back-btn:hover { color: #000; transform: translateY(-2px); }
    </style>
</head>
<body>

<a href="index.html" class="back-btn" data-i18n="backHome">üè† Home</a>
<canvas id="gameCanvas" width="800" height="350"></canvas>

<script src="lingue.js"></script>

<script>
    window.isGamePage = true; 

    const canvas = document.getElementById('gameCanvas');
    const ctx = canvas.getContext('2d');

    // --- COLORI ---
    const DINO_COLOR = "#4CAF50"; // Verde Emoji
    const CACTUS_COLOR = "#2E7D32"; // Verde Cactus scuro
    const ROCK_COLOR = "#7f8c8d"; // Grigio Roccia
    const CLOUD_COLOR = "#ffffff"; // Bianco Nuvola

    // Variabili di gioco
    // Aumentata un po' la width del dino per il nuovo disegno
    let dino = { x: 50, y: 250, width: 45, height: 45, dy: 0, jumpPower: -13, grounded: true };
    let obstacles = [];
    let clouds = [];
    let frame = 0;
    let score = 0;
    let gameSpeed = 6;
    let isGameOver = false;
    let isPlaying = false;
    const groundY = 300; // Altezza del terreno

    // --- FUNZIONI DI DISEGNO ---

    // Disegna un T-Rex verde rivolto a DESTRA
    function drawDino(x, y, w, h) {
        ctx.fillStyle = DINO_COLOR;
        
        // Corpo e Coda
        ctx.beginPath();
        ctx.moveTo(x, y + h - 10); 
        ctx.lineTo(x + w/2, y + h);
        ctx.lineTo(x + w - 10, y + h/2);
        ctx.lineTo(x + w - 10, y + 10);
        ctx.lineTo(x + 10, y + 5);
        ctx.closePath();
        ctx.fill();

        // Testa (Rivolta a destra)
        ctx.fillRect(x + w - 20, y, 20, 18);

        // Occhio
        ctx.fillStyle = "white";
        ctx.fillRect(x + w - 8, y + 4, 4, 4);
        ctx.fillStyle = "black";
        ctx.fillRect(x + w - 6, y + 5, 2, 2);

        // Zampe (semplice animazione di corsa)
        ctx.fillStyle = DINO_COLOR;
        if (isPlaying && dino.grounded) {
            if (frame % 20 < 10) {
                ctx.fillRect(x + 15, y + h - 5, 8, 10); // Zampa posteriore gi√π
                ctx.fillRect(x + w - 15, y + h - 10, 8, 5); // Zampa anteriore su
            } else {
                ctx.fillRect(x + 15, y + h - 10, 8, 5); // Zampa posteriore su
                ctx.fillRect(x + w - 15, y + h - 5, 8, 10); // Zampa anteriore gi√π
            }
        } else {
            // In salto o fermo
            ctx.fillRect(x + 15, y + h - 5, 8, 8);
            ctx.fillRect(x + w - 15, y + h - 5, 8, 8);
        }
    }

    // Disegna Cactus Verde
    function drawCactus(x, y, w, h) {
        ctx.fillStyle = CACTUS_COLOR;
        // Fusto centrale
        ctx.fillRect(x + w/3, y, w/3, h);
        // Braccio SX
        ctx.fillRect(x, y + 15, w/3, 6);
        ctx.fillRect(x, y + 8, 6, 15);
        // Braccio DX
        ctx.fillRect(x + 2*w/3, y + 20, w/3, 6);
        ctx.fillRect(x + w - 6, y + 12, 6, 15);
    }

    // Disegna Roccia Grigia
    function drawRock(x, y, w, h) {
        ctx.fillStyle = ROCK_COLOR;
        ctx.beginPath();
        ctx.moveTo(x, y + h);
        ctx.lineTo(x + 10, y + 5);
        ctx.lineTo(x + w/2, y);
        ctx.lineTo(x + w - 5, y + 8);
        ctx.lineTo(x + w, y + h);
        ctx.closePath();
        ctx.fill();
        // Dettagli roccia
        ctx.fillStyle = "rgba(0,0,0,0.2)";
        ctx.beginPath();
        ctx.moveTo(x+5, y+h); ctx.lineTo(x+15, y+10); ctx.lineTo(x+25, y+h); ctx.fill();
    }

    // Disegna Nuvola Bianca
    function drawCloud(x, y) {
        ctx.fillStyle = CLOUD_COLOR;
        ctx.beginPath();
        ctx.arc(x, y, 20, Math.PI * 0.5, Math.PI * 1.5);
        ctx.arc(x + 25, y - 15, 25, Math.PI * 1, Math.PI * 2);
        ctx.arc(x + 50, y - 5, 20, Math.PI * 1.2, Math.PI * 0.2);
        ctx.arc(x + 25, y + 5, 20, Math.PI * 0, Math.PI * 1);
        ctx.closePath();
        ctx.fill();
    }

    // --- LOGICA DI GIOCO ---

    function handleClouds() {
        if (frame % 200 === 0) {
            // Nuvole pi√π in alto nel cielo
            clouds.push({ x: canvas.width + 50, y: Math.random() * 100 + 40 });
        }
        clouds.forEach((c, i) => {
            c.x -= gameSpeed * 0.2; // Nuvole lente
            drawCloud(c.x, c.y);
            if (c.x < -80) clouds.splice(i, 1);
        });
    }

    function update() {
        if (!isPlaying || isGameOver) return;

        // Fisica Dino
        if (!dino.grounded) {
            dino.dy += 0.7; 
            dino.y += dino.dy;
        }
        
        // Collisione col terreno
        if (dino.y + dino.height >= groundY) {
            dino.y = groundY - dino.height;
            dino.dy = 0;
            dino.grounded = true;
        }

        // Generazione Ostacoli (Cactus o Roccia)
        if (frame % 110 === 0) { 
            let type = Math.random() > 0.6 ? 'rock' : 'cactus';
            let width, height;

            if (type === 'cactus') {
                width = 35; height = 55; 
            } else {
                width = 45; height = 25; // Roccia pi√π bassa e larga
            }
            
            obstacles.push({ x: canvas.width, y: groundY - height, width: width, height: height, type: type });
        }
        
        // Pulizia ostacoli usciti dallo schermo
        if (obstacles.length > 0 && obstacles[0].x < -50) obstacles.shift();

        // Collisioni Dino-Ostacolo
        obstacles.forEach(obs => {
            // Hitbox leggermente ridotta per essere meno punitiva
            let padding = 8;
            if (dino.x + padding < obs.x + obs.width - padding && 
                dino.x + dino.width - padding > obs.x + padding &&
                dino.y + padding < obs.y + obs.height && 
                dino.y + dino.height > obs.y) {
                isGameOver = true;
            }
        });

        obstacles.forEach(obs => obs.x -= gameSpeed);

        score++;
        if(score % 600 === 0) gameSpeed += 0.5;
        frame++;
    }

    function draw() {
        ctx.clearRect(0, 0, canvas.width, canvas.height);

        // Nuvole sfondo (prima di tutto il resto)
        handleClouds();

        if (!isPlaying) {
            ctx.fillStyle = "#333";
            ctx.font = "bold 24px 'Segoe UI', sans-serif";
            ctx.textAlign = "center";
            // Ombra bianca per leggere meglio sul cielo azzurro
            ctx.shadowColor = "white"; ctx.shadowBlur = 5;
            ctx.fillText(t('startMsg'), canvas.width / 2, canvas.height / 2);
            ctx.shadowBlur = 0;
            drawDino(dino.x, dino.y, dino.width, dino.height);
            return;
        }

        // Disegna Ostacoli
        obstacles.forEach(obs => {
            if (obs.type === 'cactus') {
                drawCactus(obs.x, obs.y, obs.width, obs.height);
            } else {
                drawRock(obs.x, obs.y, obs.width, obs.height);
            }
        });

        // Disegna Dino
        drawDino(dino.x, dino.y, dino.width, dino.height);

        // UI Score
        ctx.fillStyle = "#333";
        ctx.font = "bold 20px 'Segoe UI', sans-serif";
        ctx.textAlign = "right";
        ctx.fillText(t('score') + Math.floor(score / 10).toString(), canvas.width - 30, 40);

        if (isGameOver) {
            // Velo bianco semitrasparente
            ctx.fillStyle = "rgba(255, 255, 255, 0.7)";
            ctx.fillRect(0,0,canvas.width, canvas.height);
            
            ctx.fillStyle = "#e74c3c"; // Rosso per Game Over
            ctx.font = "bold 50px 'Segoe UI', sans-serif";
            ctx.textAlign = "center";
            ctx.fillText(t('gameOver'), canvas.width / 2, canvas.height / 2);
            
            ctx.fillStyle = "#333";
            ctx.font = "24px 'Segoe UI', sans-serif";
            ctx.fillText(t('restartMsg'), canvas.width / 2, canvas.height / 2 + 50);
        }
    }

    function gameLoop() {
        update();
        draw();
        requestAnimationFrame(gameLoop);
    }

    // Input (Tastiera)
    document.addEventListener('keydown', (e) => {
        if (e.code === 'Space' || e.code === 'ArrowUp') {
            if (!isPlaying) { isPlaying = true; return; }
            if (isGameOver) { location.reload(); return; }
            if (dino.grounded) {
                dino.dy = dino.jumpPower;
                dino.grounded = false;
            }
        }
    });

    // Input (Touch per mobile)
    canvas.addEventListener('touchstart', (e) => {
        e.preventDefault();
        if (!isPlaying) { isPlaying = true; return; }
        if (isGameOver) { location.reload(); return; }
        if (dino.grounded) {
            dino.dy = dino.jumpPower;
            dino.grounded = false;
        }
    });

    gameLoop();
</script>
</body>
</html>
