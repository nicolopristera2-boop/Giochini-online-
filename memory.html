<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Memory Game</title>
    <style>
        body { font-family: 'Segoe UI', sans-serif; background: #2c3e50; color: white; display: flex; flex-direction: column; align-items: center; min-height: 100vh; margin: 0; }
        .header { margin-top: 20px; text-align: center; }
        .back-btn { position: absolute; top: 20px; left: 20px; color: white; text-decoration: none; font-weight: bold; }
        
        .game-info { display: flex; gap: 20px; margin: 20px 0; font-size: 1.2rem; }
        
        .grid { display: grid; grid-template-columns: repeat(4, 1fr); gap: 10px; max-width: 500px; margin: 0 auto; }
        
        .card { width: 80px; height: 80px; background-color: #34495e; border-radius: 8px; cursor: pointer; display: flex; align-items: center; justify-content: center; font-size: 2rem; transition: transform 0.3s; transform-style: preserve-3d; }
        .card.flipped { background-color: #f1c40f; transform: rotateY(180deg); }
        .card.matched { background-color: #2ecc71; visibility: hidden; } /* Oppure lascia visibile ma verde */
        
        .btn-restart { padding: 10px 20px; background: #e74c3c; color: white; border: none; border-radius: 5px; font-size: 1rem; cursor: pointer; margin-top: 30px; }
    </style>
</head>
<body>

<a href="index.html" class="back-btn" data-i18n="backHome">üè† Home</a>

<div class="header">
    <h1 data-i18n="game3Title">Memory</h1>
    <div class="game-info">
        <span id="movesText"><span data-i18n="moves">Mosse: </span> <span id="moves">0</span></span>
        <span id="timeText"><span data-i18n="time">Tempo: </span> <span id="time">0</span>s</span>
    </div>
</div>

<div class="grid" id="grid"></div>

<button class="btn-restart" onclick="location.reload()" data-i18n="restartMsg">Ricomincia</button>

<script src="lingue.js"></script>
<script>
    window.isGamePage = true;

    const emojis = ['üçé','üçé','üçå','üçå','üçá','üçá','üçí','üçí','üê∂','üê∂','üê±','üê±','üê≠','üê≠','üêπ','üêπ'];
    let cards = [...emojis].sort(() => 0.5 - Math.random());
    
    let grid = document.getElementById('grid');
    let movesDisplay = document.getElementById('moves');
    let timeDisplay = document.getElementById('time');
    
    let flippedCards = [];
    let moves = 0;
    let timer;
    let seconds = 0;
    let matches = 0;
    let gameStarted = false;

    function startTimer() {
        if(gameStarted) return;
        gameStarted = true;
        timer = setInterval(() => {
            seconds++;
            timeDisplay.innerText = seconds;
        }, 1000);
    }

    // Creazione Griglia
    cards.forEach((emoji, index) => {
        let card = document.createElement('div');
        card.classList.add('card');
        card.dataset.emoji = emoji;
        card.dataset.index = index;
        
        // Contenuto nascosto inizialmente
        let content = document.createElement('span');
        content.innerText = emoji;
        content.style.opacity = '0';
        card.appendChild(content);

        card.addEventListener('click', flipCard);
        grid.appendChild(card);
    });

    function flipCard() {
        if (!gameStarted) startTimer();
        
        let card = this;
        if (card.classList.contains('flipped') || flippedCards.length >= 2) return;

        card.classList.add('flipped');
        card.firstChild.style.opacity = '1';
        flippedCards.push(card);

        if (flippedCards.length === 2) {
            moves++;
            movesDisplay.innerText = moves;
            checkMatch();
        }
    }

    function checkMatch() {
        let [c1, c2] = flippedCards;
        
        if (c1.dataset.emoji === c2.dataset.emoji) {
            // Match!
            c1.classList.add('matched');
            c2.classList.add('matched');
            flippedCards = [];
            matches++;
            
            if (matches === emojis.length / 2) {
                clearInterval(timer);
                // Usa t() per il messaggio di vittoria
                setTimeout(() => alert(t('youWin') + "\n" + t('score') + moves), 500);
            }
        } else {
            // No Match
            setTimeout(() => {
                c1.classList.remove('flipped');
                c1.firstChild.style.opacity = '0';
                c2.classList.remove('flipped');
                c2.firstChild.style.opacity = '0';
                flippedCards = [];
            }, 1000);
        }
    }
</script>

</body>
</html>
